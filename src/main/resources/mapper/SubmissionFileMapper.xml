<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.no99.edunexusassignment_and_assessment.mapper.SubmissionFileMapper">

    <!-- 结果映射 -->
    <resultMap id="SubmissionFileResultMap" type="com.no99.edunexusassignment_and_assessment.entity.SubmissionFile">
        <id column="id" property="id"/>
        <result column="submission_id" property="submissionId"/>
        <result column="filename" property="filename"/>
        <result column="file_url" property="fileUrl"/>
        <result column="file_size" property="fileSize"/>
        <result column="mime_type" property="mimeType"/>
        <result column="uploaded_at" property="uploadedAt"/>
    </resultMap>

    <!-- 插入文件记录 -->
    <insert id="insert" parameterType="com.no99.edunexusassignment_and_assessment.entity.SubmissionFile" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO submission_files (
            submission_id, filename, file_url, file_size, mime_type, uploaded_at
        ) VALUES (
            #{submissionId}, #{filename}, #{fileUrl}, #{fileSize}, #{mimeType}, #{uploadedAt}
        )
    </insert>

    <!-- 根据ID查询文件记录 -->
    <select id="selectById" parameterType="int" resultMap="SubmissionFileResultMap">
        SELECT * FROM submission_files WHERE id = #{id}
    </select>

    <!-- 根据提交ID查询所有文件 -->
    <select id="selectBySubmissionId" parameterType="int" resultMap="SubmissionFileResultMap">
        SELECT * FROM submission_files
        WHERE submission_id = #{submissionId}
        ORDER BY uploaded_at ASC
    </select>

    <!-- 删除文件记录 -->
    <delete id="deleteById" parameterType="int">
        DELETE FROM submission_files WHERE id = #{id}
    </delete>

    <!-- 根据提交ID删除所有文件 -->
    <delete id="deleteBySubmissionId" parameterType="int">
        DELETE FROM submission_files WHERE submission_id = #{submissionId}
    </delete>

</mapper>
